apiVersion: v1
kind: Service              
metadata:
  name: frontend-lb
spec:
  type: LoadBalancer       
  ports:
  - port: 80              
    targetPort: 8080        
  selector:            
    app: frontend    
---
apiVersion:  apps/v1 #extensions/v1beta1
kind: Deployment
metadata:
  name: frontend
  labels:
    app: frontend
spec:
  replicas: 2                                             
  minReadySeconds: 15
  strategy:
    type: RollingUpdate                                   
    rollingUpdate: 
      maxUnavailable: 1                                   
      maxSurge: 1                                         
  selector:
    matchLabels:
      app: frontend
      tier: experiment
  strategy:
    type: Recreate
  template:
    metadata:
      labels:
        app: frontend
        tier: experiment
    spec:
      containers:
      - image: alessandroargentieri/exp-frontend
        name: frontend
        env:
        - name: PROVA1
          value: http://frontend-lb
        - name: PROVA2
          value: http://gateway-lb  
        - name: PROVA3
          value: "http://frontend-lb"
        - name: PROVA4
          value: "http://gateway-lb"
        - name: PROVA5
          value: frontend-lb
        - name: PROVA6
          value: gateway-lb        
        - name: PROVA7
          value: http://gateway-lb.default.svc.cluster.local:80
        - name: PROVA8
          value: "gateway-lb"
        - name: OAUTH2_CLIENT_ID
          value: "efe81665e4bbab322bb8"
        - name: FRONTEND_HOST
          value:  "http://192.168.64.2:32065"     # http://frontend-lb  
        - name: LOGIN_REDIRECT_PATH
          value: "login/oauth2/code/github"
        - name: OAUTH2_STATE
          value: "fknrrdyjikfn"
        - name: OAUTH2_SCOPE
          value: "user"   
        - name: GATEWAY_HOST
          value: "http://192.168.64.2:32392"    # http://gateway-lb
        - name: GATEWAY_ROOT_PATH
          value: "javalin-api-gateway"
        - name: OAUTH2_RESOURCE_PROVIDER_URL
          value: "https://github.com/login/oauth/authorize"   
        ports:
        - containerPort: 8080
          name: frontend
